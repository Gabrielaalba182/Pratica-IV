(function(){ const body = document.body; function applyTheme(t){ if(t==='dark'){ body.setAttribute('data-theme','dark'); } else if(t==='high-contrast'){ body.setAttribute('data-theme','high-contrast'); } else { body.setAttribute('data-theme','light'); } } const saved = localStorage.getItem('project-theme')||'light'; applyTheme(saved); document.addEventListener('DOMContentLoaded', function(){ const tBtn = document.getElementById('toggle-theme'); const cBtn = document.getElementById('toggle-contrast'); if(tBtn){ tBtn.addEventListener('click', ()=>{ const cur = body.getAttribute('data-theme')==='dark' ? 'light' : 'dark'; applyTheme(cur); localStorage.setItem('project-theme',cur); tBtn.setAttribute('aria-pressed', cur==='dark'); }); } if(cBtn){ cBtn.addEventListener('click', ()=>{ const cur = body.getAttribute('data-theme')==='high-contrast' ? 'light':'high-contrast'; applyTheme(cur); localStorage.setItem('project-theme',cur); cBtn.setAttribute('aria-pressed', cur==='high-contrast'); }); } document.querySelectorAll('a').forEach(a=>{ if(!a.hasAttribute('tabindex')) a.setAttribute('tabindex','0'); }); }); document.addEventListener('submit', function(e){ if(e.target && e.target.id==='contact-form'){ e.preventDefault(); var name = e.target.name ? e.target.name.value : ''; var res = document.getElementById('form-result'); if(!name){ if(res) res.textContent='Por favor preencha o nome.'; e.target.name.focus(); return; } if(res) res.textContent='Mensagem recebida. Obrigado, '+name+'!'; } }); })(); import { initRouter } from './router.js'; import { setupGlobalHandlers } from './forms.js'; document.addEventListener('DOMContentLoaded', () => { initRouter(); setupGlobalHandlers(); }); import { render } from './templates.js'; const routes = { '/': () => import('./home.js'), '/cadastro': () => import('./cadastro.js'), '/sobre': () => import('./about.js'), }; function parseLocation() { const hash = location.hash.replace('#', '') || '/'; return hash; } export async function initRouter() { window.addEventListener('hashchange', router); document.addEventListener('click', onNavClick); await router(); } async function router() { const path = parseLocation(); const loader = routes[path] || routes['/']; const mod = await loader(); const content = await mod.default(); render(content); } function onNavClick(e) { const a = e.target.closest('a[data-link]'); if (!a) return; e.preventDefault(); location.hash = a.getAttribute('href'); } const PREFIX = 'praticaIII_v1_'; export function save(key, value) { localStorage.setItem(PREFIX + key, JSON.stringify(value)); } export function load(key, fallback = null) { const raw = localStorage.getItem(PREFIX + key); return raw ? JSON.parse(raw) : fallback; } export function remove(key) { localStorage.removeItem(PREFIX + key); } export default async function page() { return `<h1>Bem-vindo</h1><p>Este é o app dinâmico da Prática III. Use o menu para navegar.</p>`; } export default async function page() { return `<h1>Sobre</h1><p>Projeto desenvolvido com JavaScript avançado (ES Modules), LocalStorage, DOM e SPA simples.</p>`; } import { escapeHtml } from './templates.js'; import { load } from './storage.js'; export default async function page() { const cadastros = load('cadastros', []); const listHtml = cadastros.length === 0 ? '<p>Nenhum cadastro salvo.</p>' : `<ul>${cadastros.map(c => `<li>${escapeHtml(c.name || '')} — ${escapeHtml(c.email || '')}</li>`).join('')}</ul>`; return ` <h1>Cadastro</h1> <form id="cadastro-form" novalidate> <div class="form-field"> <label for="name">Nome</label> <input id="name" name="name" required minlength="3" /> </div> <div class="form-field"> <label for="email">Email</label> <input id="email" name="email" type="email" required data-validate="email" /> </div> <div class="form-field"> <label for="age">Idade</label> <input id="age" name="age" data-validate="number" /> </div> <button type="submit">Salvar</button> </form> <h2>Cadastros salvos</h2> <div id="cadastros-list">${listHtml}</div> `; } import { save, load } from './storage.js'; function createError(element, message) { let em = element.nextElementSibling; if (!em || !em.classList.contains('error-message')) { em = document.createElement('div'); em.className = 'error-message'; element.after(em); } em.textContent = message; element.classList.add('error'); } function clearError(element) { let em = element.nextElementSibling; if (em && em.classList.contains('error-message')) em.remove(); element.classList.remove('error'); } function validateField(input) { clearError(input); const val = input.value.trim(); const type = input.getAttribute('data-validate') || input.type || 'text'; const required = input.hasAttribute('required'); if (required && !val) { createError(input, 'Campo obrigatório.'); return false; } if (val) { if (type === 'email' || input.getAttribute('data-validate') === 'email') { const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; if (!re.test(val)) { createError(input, 'Email inválido.'); return false; } } if (input.getAttribute('data-validate') === 'number') { if (isNaN(Number(val))) { createError(input, 'Valor numérico esperado.'); return false; } } if (input.getAttribute('minlength')) { const min = Number(input.getAttribute('minlength')); if (val.length < min) { createError(input, `Mínimo ${min} caracteres.`); return false; } } } return true; } export function setupGlobalHandlers() { document.getElementById('app').addEventListener('blur', (e) => { const t = e.target; if (t.matches('input,textarea,select')) validateField(t); }, true); document.getElementById('app').addEventListener('submit', (e) => { const form = e.target; if (!form.matches('form')) return; e.preventDefault(); const inputs = Array.from(form.querySelectorAll('input,textarea,select')); const valid = inputs.map(validateField).every(Boolean); if (!valid) { showToast('Corrija os campos em destaque.', 3000); return; } if (form.id === 'cadastro-form') { const data = Object.fromEntries(new FormData(form).entries()); if (data.age) data.age = Number(data.age); const existing = load('cadastros', []); existing.push({ ...data, createdAt: new Date().toISOString() }); save('cadastros', existing); form.reset(); showToast('Cadastro salvo com sucesso!', 2500); } }); } export function showToast(msg, timeout = 2000) { const t = document.createElement('div'); t.className = 'toast'; t.textContent = msg; document.body.appendChild(t); setTimeout(() => t.remove(), timeout); } export function render(htmlString) { const app = document.getElementById('app'); app.innerHTML = htmlString; app.dispatchEvent(new CustomEvent('page:rendered')); } export function escapeHtml(s) { return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }